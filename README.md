# 图像识别自动化购买脚本

本项目包含一个使用 Python 编写的自动化脚本 (`auto_clicker.py`)，它通过识别屏幕上的图像模板来模拟用户的鼠标和键盘操作，以完成一系列的购买流程。

## 功能

- **图像驱动**: 无需记录复杂的坐标，只需提供目标UI元素的截图即可。
- **自动化流程**: 自动执行返回首页、进入市场、搜索商品、点击购买、输入数量、确认等一系列操作。
- **可配置**: 轻松修改要购买的商品、数量等参数。
- **健壮性**: 包含超时机制和错误处理，使脚本运行更稳定。

## 项目结构

为了让脚本正常工作，请确保您的项目文件夹包含以下结构：

```
/wg1
|-- images/                 <-- 存放所有模板图片的文件夹
|   |-- btn_buy.png
|   |-- btn_close.png
|   |-- btn_home.png
|   |-- btn_market.png
|   |-- btn_refresh.png
|   |-- btn_search.png
|   |-- input_quantity.png
|   |-- input_search.png
|   `-- item_target_goods.png  <-- (这是一个示例，请替换为您自己的商品图片)
|
|-- auto_clicker.py         <-- 主程序脚本
|-- click_logger.py         <-- (旧的坐标记录脚本)
`-- README.md               <-- 本说明文件
```

---

## 快速开始

本项目推荐使用 `uv` 进行虚拟环境和依赖管理。

### 1. 环境准备

确保您的电脑已经安装了 Python (建议 3.11 或更高版本) 和 `uv`。

### 2. 创建虚拟环境并安装依赖

打开命令行工具，在项目根目录下运行以下命令，`uv` 会自动读取 `pyproject.toml` 文件来创建环境并安装所有依赖。

```bash
uv venv
uv sync
```
这会创建一个名为 `.venv` 的虚拟环境，并把 `pyautogui`, `opencv-python`, `pydirectinput` 和 `pywin32` 安装进去。

### 3. 激活虚拟环境

根据您的操作系统，使用以下命令激活环境：

**Windows (CMD):**
```bash
.venv\\Scripts\\activate
```

**Windows (PowerShell):**
```powershell
.venv\\Scripts\\Activate.ps1
```

**macOS / Linux:**
```bash
source .venv/bin/activate
```


### 3. 准备模板图片

这是最关键的一步。脚本的识别成功率高度依赖于您提供的图片质量。

1.  **创建文件夹**: 在项目根目录下创建一个名为 `images` 的文件夹。
2.  **截图**:
    *   逐一截取您操作流程中需要点击或识别的每个UI元素。
    *   **截图要点**:
        *   **最小化原则**: 只截取有代表性的、最小的部分。例如，一个“购买”按钮，不要截取按钮周围的大片空白区域。
        *   **独特性**: 确保截图区域是屏幕上独一无二的，避免背景干扰。
        *   **保持一致**: 截图时的应用窗口大小、分辨率应与运行脚本时保持一致。
        *   **命名**: 按照下面的 “图片清单” 为截图文件命名，并全部保存为 `.png` 格式。

#### 图片清单

请将截取的图片按以下名称存放在 `images` 文件夹中：

- `btn_home.png`: **首页按钮**，用于返回主界面。
- `btn_market.png`: **市场按钮**，用于进入市场。
- `input_search.png`: **搜索输入框** 的一部分，用于定位输入框。
- `btn_search.png`: **搜索按钮**。
- `item_target_goods.png`: **目标商品** 的图片。**这是您需要根据想买的物品自行更换的图片。**
- `btn_refresh.png`: **刷新按钮**，用于刷新价格。
- `btn_buy.png`: **购买按钮**。
- `input_quantity.png`: **购买数量输入框** 的一部分。
- `btn_close.png`: **关闭按钮**，用于在操作完成后关闭弹窗或界面。


### 4. 配置脚本

打开 `auto_clicker.py` 文件，找到文件末尾的 `if __name__ == "__main__"` 部分。

根据您的需求，修改以下三个变量：

```python
# 要搜索和购买的商品信息
TARGET_ITEM_IMAGE = "item_target_goods.png"  # 对应 images 文件夹中的商品截图文件名
TARGET_ITEM_KEYWORD = "您想搜索的商品名"     # 在搜索框中要输入的文字
PURCHASE_QUANTITY = 10                     # 希望购买的数量
```

### 5. 运行脚本

一切准备就绪后，**确保您已经激活了虚拟环境**，然后运行：

```bash
python auto_clicker.py
```

脚本将开始执行自动化流程。请不要在脚本运行时移动鼠标或使用键盘，以免干扰操作。

---

## 注意事项

- **屏幕遮挡**: 确保脚本运行时，目标应用窗口没有被其他窗口遮挡。
- **分辨率和缩放**: 运行脚本的屏幕分辨率和系统缩放比例，应与您截图时保持一致。
- **识别失败**: 如果脚本提示找不到某个图片，请尝试重新截取该图片，确保它清晰、无干扰且具有唯一性。您也可以在 `auto_clicker.py` 中调整 `confidence` 参数（值越低容忍度越高，但误判率也可能增加）。
